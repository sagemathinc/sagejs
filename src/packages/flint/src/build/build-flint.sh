#!/usr/bin/env bash
set -ev
cd $BUILD

### Now build FLINT

curl http://www.flintlib.org/flint-$FLINT_VERSION.tar.gz -o flint-$FLINT_VERSION.tar.gz
tar xf flint-$FLINT_VERSION.tar.gz
rm flint-$FLINT_VERSION.tar.gz
cd flint-$FLINT_VERSION

# - disabled-shared: shared is not used for WASM.
# - disable-pthread: threading support for WASM is pretty limited still.
emconfigure ./configure \
    --with-mpir="$PACKAGES"/mpir/dist/local/  \
    --with-mpfr="$PACKAGES"/mpfr/dist/local/  \
    --with-gmp="$PACKAGES"/gmp/dist/local/    \
    --with-ntl="$PACKAGES"/ntl/dist/local/    \
    --disable-shared  \
    --disable-pthread \
    --prefix=$PREFIX

# Very parallel since flint has like 10K tiny files (generated by some template system),
# so most of the time is just starting emscript python which then calls clang.
emmake make -j12

emmake make install

